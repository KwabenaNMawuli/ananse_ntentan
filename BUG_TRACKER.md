# Bug Tracker - Ananse Ntentan Image Display Issues

## Date: February 5, 2026

---

## âœ… RESOLVED BUGS

### 1. CORS Configuration Mismatch
**Symptom:** Frontend showed "Error connecting to server" - complete failure to load feed
**Root Cause:** Backend CORS middleware was configured to accept requests from `http://localhost:3001`, but frontend was actually running on `http://localhost:3003`
**Location:** `ananse_ntentan_backend/.env` line with `FRONTEND_URL`
**Fix Applied:** Changed `FRONTEND_URL=http://localhost:3001` to `FRONTEND_URL=http://localhost:3003`
**Status:** âœ… RESOLVED - Feed now loads successfully

### 2. Images Blocked by Cross-Origin-Resource-Policy
**Symptom:** Images not displaying in feed panels - browser console showed `net::ERR_BLOCKED_BY_RESPONSE.NotSameOrigin` error
**Root Cause:** Helmet middleware was setting `Cross-Origin-Resource-Policy: same-origin` header by default, blocking image requests from frontend (localhost:3003) to backend (localhost:5000) because they are different origins
**Location:** `ananse_ntentan_backend/server.js` helmet configuration
**Fix Applied:** Configured helmet with `crossOriginResourcePolicy: { policy: "cross-origin" }` to allow cross-origin image loading
**Status:** âœ… RESOLVED - Images now display correctly in feed

---

## ðŸ”´ UNRESOLVED BUGS

### None Currently!
**Note:** Issue was moved to Resolved Bugs section after successful fix

---

## ðŸ“‹ INVESTIGATION LOG

### Findings So Far:
- âœ… Backend server is running
- âœ… MongoDB connection is working
- âœ… Frontend can fetch feed data
- âœ… CORS is properly configured
- â“ Image files exist in GridFS (need to verify)
- â“ Image URLs being constructed correctly (need to verify)
- â“ Image endpoint responding correctly (need to verify)

---

## ðŸ› ï¸ TECHNICAL CONTEXT

### Frontend Image Display Logic:
Located in: `ananse_ntentan_frontend/src/Components/Feed.js` (lines 104-150)

```javascript
const getImageId = (panel) => {
  const candidate = normalizeId(panel?.imageFileId);
  return isValidObjectId(candidate) ? candidate : null;
};

const imageId = getImageId(panel);
const imageUrl = imageId ? `${apiBase}/files/image/${imageId}` : null;
```

### Backend Image Serving:
Route: `GET /api/files/image/:id`
Location: `ananse_ntentan_backend/routes/files.js` (lines 36-73)
- Retrieves file from GridFS
- Streams binary data with proper Content-Type headers

### Image Storage:
- Images stored in MongoDB GridFS (bucket: 'uploads')
- Each panel's `imageFileId` field stores the GridFS ObjectId
- Images generated by `imageService.generateAllPanelImages()`

---

**Last Updated:** February 5, 2026
**Current Focus:** Diagnosing why images aren't displaying despite successful feed load
